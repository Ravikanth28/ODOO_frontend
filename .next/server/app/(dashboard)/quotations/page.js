(()=>{var e={};e.id=710,e.ids=[710],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6553:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>o}),s(6378),s(8032),s(5866),s(6835);var a=s(3191),r=s(8716),n=s(7922),i=s.n(n),l=s(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let o=["",{children:["(dashboard)",{children:["quotations",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,6378)),"E:\\frontend\\app\\(dashboard)\\quotations\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,8032)),"E:\\frontend\\app\\(dashboard)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,6835)),"E:\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\frontend\\app\\(dashboard)\\quotations\\page.tsx"],m="/(dashboard)/quotations/page",x={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(dashboard)/quotations/page",pathname:"/quotations",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},5490:(e,t,s)=>{Promise.resolve().then(s.bind(s,5830))},5830:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(326),r=s(7577),n=s(6824),i=s(3594),l=s(7698),d=s(2980),o=s(2948);function c(){let[e,t]=(0,r.useState)([]),[s,c]=(0,r.useState)([]),[m,x]=(0,r.useState)([]),[u,p]=(0,r.useState)([]),[h,g]=(0,r.useState)(!0),[j,y]=(0,r.useState)(!1),[b,v]=(0,r.useState)(null),[N,f]=(0,r.useState)(null),[C,P]=(0,r.useState)(!1),[w,k]=(0,r.useState)(!1),[S,D]=(0,r.useState)(null),[L,q]=(0,r.useState)({productId:"",quantity:"1",unitPrice:"",discount:"0"}),[I,A]=(0,r.useState)(!1),[T,F]=(0,r.useState)(!1),[E,_]=(0,r.useState)({templateId:"",customerId:"",startDate:""}),[W,M]=(0,r.useState)(!1),[Y,O]=(0,r.useState)({name:"",description:"",validityDays:"30",planId:"",recurringPeriod:"",notes:"",termsAndConditions:""}),{showToast:R}=(0,o.p)(),$=(0,n.PR)(),Q=$?.role==="ADMIN",Z=async()=>{try{let[e,s,a,r]=await Promise.all([n.rW.getAll(),n.Co.getAll(),n.F3.getAll(),n.h3.getAll({role:"PORTAL_USER"}).catch(()=>[])]);t(e),c(s),x(a),p(r)}catch(e){R(e.message||"Failed to load data","error")}finally{g(!1)}},U=e=>{v(e),O({name:e.name,description:e.description||"",validityDays:String(e.validityDays),planId:e.planId,recurringPeriod:e.recurringPeriod||"",notes:e.notes||"",termsAndConditions:e.termsAndConditions||""}),y(!0)},B=async()=>{if(!Y.name||!Y.planId){R("Name and plan are required","error");return}P(!0);try{let e={...Y,validityDays:parseInt(Y.validityDays)||30,recurringPeriod:Y.recurringPeriod||null,notes:Y.notes||null,termsAndConditions:Y.termsAndConditions||null};b?(await n.rW.update(b.id,e),R("Template updated","success")):(await n.rW.create(e),R("Template created","success")),y(!1),Z()}catch(e){R(e.message||"Failed to save template","error")}finally{P(!1)}},G=async()=>{if(N){k(!0);try{await n.rW.delete(N.id),R("Template deleted","success"),f(null),S===N.id&&D(null),Z()}catch(e){R(e.message||"Failed to delete","error")}finally{k(!1)}}},z=async e=>{if(!L.productId){R("Select a product","error");return}A(!0);try{await n.rW.addLine(e,{productId:L.productId,quantity:parseInt(L.quantity)||1,unitPrice:parseFloat(L.unitPrice)||0,discount:parseFloat(L.discount)||0}),R("Line added","success"),q({productId:"",quantity:"1",unitPrice:"",discount:"0"}),Z()}catch(e){R(e.message||"Failed to add line","error")}finally{A(!1)}},H=async(e,t)=>{try{await n.rW.deleteLine(e,t),R("Line removed","success"),Z()}catch(e){R(e.message||"Failed to remove line","error")}},K=e=>{_({templateId:e,customerId:"",startDate:new Date().toISOString().split("T")[0]}),F(!0)},V=async()=>{if(!E.customerId){R("Select a customer","error");return}M(!0);try{let e=await n.rW.createSubscription(E.templateId,{customerId:E.customerId,startDate:E.startDate});R(`Subscription ${e.subscriptionNumber} created!`,"success"),F(!1)}catch(e){R(e.message||"Failed to create subscription","error")}finally{M(!1)}},X=e=>{let t=m.find(t=>t.id===e);q({...L,productId:e,unitPrice:t?String(t.salesPrice):""})},J=async e=>{try{let t=await n.tQ.generateQuotation(e);window.open(t.pdfUrl,"_blank"),R("PDF generated","success")}catch(e){R(e.message||"Failed to generate PDF","error")}},ee={DAILY:"Daily",WEEKLY:"Weekly",MONTHLY:"Monthly",YEARLY:"Yearly"};return h?a.jsx(d.Z,{message:"Loading quotation templates..."}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Quotation Templates"}),Q&&(0,a.jsxs)("button",{onClick:()=>{v(null),O({name:"",description:"",validityDays:"30",planId:"",recurringPeriod:"",notes:"",termsAndConditions:""}),y(!0)},className:"btn-primary",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Template"]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[e.map(e=>{let t=e.lines?.reduce((e,t)=>e+(t.quantity*t.unitPrice-(t.discount||0)),0)||0;return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50",onClick:()=>D(S===e.id?null:e.id),children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[a.jsx("svg",{className:`w-4 h-4 text-gray-400 transition-transform ${S===e.id?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"font-medium text-gray-900",children:e.name}),a.jsx("span",{className:"badge bg-blue-100 text-blue-700",children:e.plan?.name}),e.recurringPeriod&&a.jsx("span",{className:"badge bg-emerald-100 text-emerald-700",children:ee[e.recurringPeriod]})]}),e.description&&a.jsx("p",{className:"text-sm text-gray-500 truncate mt-0.5",children:e.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6 text-sm",children:[(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("p",{className:"text-gray-500",children:"Validity"}),(0,a.jsxs)("p",{className:"font-medium",children:[e.validityDays," days"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("p",{className:"text-gray-500",children:"Lines"}),a.jsx("p",{className:"font-medium",children:e.lines?.length||0})]}),(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("p",{className:"text-gray-500",children:"Total"}),(0,a.jsxs)("p",{className:"font-semibold text-gray-900",children:["₹",t.toFixed(2)]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-4",onClick:e=>e.stopPropagation(),children:[a.jsx("button",{onClick:()=>J(e.id),className:"btn-secondary btn-sm",children:"PDF"}),a.jsx("button",{onClick:()=>K(e.id),className:"btn-primary btn-sm",children:"Create Sub"}),Q&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("button",{onClick:()=>U(e),className:"btn-secondary btn-sm",children:"Edit"}),a.jsx("button",{onClick:()=>f(e),className:"btn-danger btn-sm",children:"Delete"})]})]})]}),S===e.id&&(0,a.jsxs)("div",{className:"border-t border-gray-200 p-4 space-y-4",children:[(e.notes||e.termsAndConditions)&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[e.notes&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Notes"}),a.jsx("p",{className:"text-sm text-gray-700",children:e.notes})]}),e.termsAndConditions&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Terms & Conditions"}),a.jsx("p",{className:"text-sm text-gray-700",children:e.termsAndConditions})]})]}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Line Items"}),a.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"text-left px-3 py-2 font-medium text-gray-600",children:"Product"}),a.jsx("th",{className:"text-right px-3 py-2 font-medium text-gray-600",children:"Qty"}),a.jsx("th",{className:"text-right px-3 py-2 font-medium text-gray-600",children:"Unit Price"}),a.jsx("th",{className:"text-right px-3 py-2 font-medium text-gray-600",children:"Discount"}),a.jsx("th",{className:"text-right px-3 py-2 font-medium text-gray-600",children:"Subtotal"}),Q&&a.jsx("th",{className:"px-3 py-2 w-16"})]})}),(0,a.jsxs)("tbody",{children:[e.lines?.map(t=>a.jsxs("tr",{className:"border-t border-gray-100",children:[a.jsx("td",{className:"px-3 py-2 font-medium text-gray-900",children:t.product?.name}),a.jsx("td",{className:"px-3 py-2 text-right",children:t.quantity}),a.jsxs("td",{className:"px-3 py-2 text-right",children:["₹",Number(t.unitPrice).toFixed(2)]}),a.jsx("td",{className:"px-3 py-2 text-right",children:t.discount>0?`₹${Number(t.discount).toFixed(2)}`:"-"}),a.jsxs("td",{className:"px-3 py-2 text-right font-medium",children:["₹",(t.quantity*t.unitPrice-(t.discount||0)).toFixed(2)]}),Q&&a.jsx("td",{className:"px-3 py-2 text-right",children:a.jsx("button",{onClick:()=>H(e.id,t.id),className:"text-red-500 hover:text-red-700 text-xs",children:"Remove"})})]},t.id)),(!e.lines||0===e.lines.length)&&a.jsx("tr",{children:a.jsx("td",{colSpan:Q?6:5,className:"px-3 py-4 text-center text-gray-500",children:"No line items."})})]})]})}),Q&&(0,a.jsxs)("div",{className:"mt-3 flex items-end gap-2",children:[a.jsx("div",{className:"flex-1",children:(0,a.jsxs)("select",{value:L.productId,onChange:e=>X(e.target.value),className:"form-select text-sm",children:[a.jsx("option",{value:"",children:"Select Product"}),m.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ","₹",Number(e.salesPrice).toFixed(2)]},e.id))]})}),a.jsx("div",{className:"w-20",children:a.jsx("input",{type:"number",min:"1",placeholder:"Qty",value:L.quantity,onChange:e=>q({...L,quantity:e.target.value}),className:"form-input text-sm"})}),a.jsx("div",{className:"w-28",children:a.jsx("input",{type:"number",step:"0.01",placeholder:"Price",value:L.unitPrice,onChange:e=>q({...L,unitPrice:e.target.value}),className:"form-input text-sm"})}),a.jsx("div",{className:"w-24",children:a.jsx("input",{type:"number",step:"0.01",placeholder:"Discount",value:L.discount,onChange:e=>q({...L,discount:e.target.value}),className:"form-input text-sm"})}),a.jsx("button",{onClick:()=>z(e.id),disabled:I,className:"btn-primary btn-sm",children:I?"...":"Add"})]})]})]})]},e.id)}),0===e.length&&a.jsx("div",{className:"card p-8 text-center text-gray-500",children:"No quotation templates found. Create one to get started."})]}),a.jsx(i.Z,{isOpen:j,onClose:()=>y(!1),title:b?"Edit Template":"New Quotation Template",onSubmit:B,submitLabel:b?"Update":"Create",loading:C,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[a.jsx("label",{className:"form-label",children:"Template Name *"}),a.jsx("input",{type:"text",required:!0,value:Y.name,onChange:e=>O({...Y,name:e.target.value}),className:"form-input",placeholder:"e.g., Enterprise Annual Plan"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"form-label",children:"Recurring Plan *"}),(0,a.jsxs)("select",{value:Y.planId,onChange:e=>O({...Y,planId:e.target.value}),className:"form-select",required:!0,children:[a.jsx("option",{value:"",children:"Select a plan..."}),s.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ","₹",Number(e.price).toFixed(2)," / ",e.billingPeriod.toLowerCase()]},e.id))]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"form-label",children:"Validity Days"}),a.jsx("input",{type:"number",min:"1",value:Y.validityDays,onChange:e=>O({...Y,validityDays:e.target.value}),className:"form-input"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[a.jsx("label",{className:"form-label",children:"Recurring Period Override"}),(0,a.jsxs)("select",{value:Y.recurringPeriod,onChange:e=>O({...Y,recurringPeriod:e.target.value}),className:"form-select",children:[a.jsx("option",{value:"",children:"Use plan default"}),a.jsx("option",{value:"DAILY",children:"Daily"}),a.jsx("option",{value:"WEEKLY",children:"Weekly"}),a.jsx("option",{value:"MONTHLY",children:"Monthly"}),a.jsx("option",{value:"YEARLY",children:"Yearly"})]})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"form-label",children:"Description"}),a.jsx("textarea",{value:Y.description,onChange:e=>O({...Y,description:e.target.value}),className:"form-textarea",rows:2,placeholder:"Template description (optional)"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"form-label",children:"Notes"}),a.jsx("textarea",{value:Y.notes,onChange:e=>O({...Y,notes:e.target.value}),className:"form-textarea",rows:2,placeholder:"Internal notes (optional)"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"form-label",children:"Terms & Conditions"}),a.jsx("textarea",{value:Y.termsAndConditions,onChange:e=>O({...Y,termsAndConditions:e.target.value}),className:"form-textarea",rows:3,placeholder:"Terms and conditions for quotation (optional)"})]})]})}),a.jsx(i.Z,{isOpen:T,onClose:()=>F(!1),title:"Create Subscription from Template",onSubmit:V,submitLabel:"Create Subscription",loading:W,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"form-label",children:"Customer *"}),(0,a.jsxs)("select",{value:E.customerId,onChange:e=>_({...E,customerId:e.target.value}),className:"form-select",required:!0,children:[a.jsx("option",{value:"",children:"Select customer..."}),u.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.email,")"]},e.id))]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"form-label",children:"Start Date"}),a.jsx("input",{type:"date",value:E.startDate,onChange:e=>_({...E,startDate:e.target.value}),className:"form-input"})]})]})}),a.jsx(l.Z,{isOpen:!!N,onConfirm:G,onCancel:()=>f(null),title:"Delete Template",message:`Delete "${N?.name}"? This action cannot be undone.`,confirmLabel:"Delete",variant:"danger",loading:w})]})}},7698:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var a=s(326);function r({isOpen:e,onConfirm:t,onCancel:s,title:r,message:n,confirmLabel:i="Confirm",variant:l="danger",loading:d=!1}){return e?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[a.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:s}),(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-sm mx-4 p-6",children:[(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${"danger"===l?"bg-red-100":"bg-yellow-100"}`,children:a.jsx("svg",{className:`w-5 h-5 ${"danger"===l?"text-red-600":"text-yellow-600"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[a.jsx("button",{onClick:s,className:"btn-secondary",children:"Cancel"}),a.jsx("button",{onClick:t,disabled:d,className:"danger"===l?"btn-danger":"btn-primary",children:d?"Processing...":i})]})]})]}):null}},3594:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var a=s(326);function r({isOpen:e,onClose:t,title:s,children:r,onSubmit:n,submitLabel:i="Save",loading:l=!1,size:d="md"}){return e?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[a.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:t}),(0,a.jsxs)("div",{className:`relative bg-white rounded-lg shadow-xl w-full ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl"}[d]} mx-4 max-h-[90vh] flex flex-col`,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s}),a.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsx("div",{className:"px-6 py-4 overflow-y-auto flex-1",children:r}),n&&(0,a.jsxs)("div",{className:"flex justify-end gap-3 px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-lg",children:[a.jsx("button",{type:"button",onClick:t,className:"btn-secondary",children:"Cancel"}),a.jsx("button",{type:"button",onClick:n,disabled:l,className:"btn-primary",children:l?"Saving...":i})]})]})]}):null}s(7577)},6378:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`E:\frontend\app\(dashboard)\quotations\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[697,496,315,78],()=>s(6553));module.exports=a})();