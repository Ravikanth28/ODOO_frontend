(()=>{var e={};e.id=998,e.ids=[998],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4133:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>c}),s(2271),s(8032),s(5866),s(6835);var a=s(3191),r=s(8716),n=s(7922),i=s.n(n),l=s(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let c=["",{children:["(dashboard)",{children:["subscriptions",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2271)),"E:\\frontend\\app\\(dashboard)\\subscriptions\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,8032)),"E:\\frontend\\app\\(dashboard)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,6835)),"E:\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["E:\\frontend\\app\\(dashboard)\\subscriptions\\[id]\\page.tsx"],m="/(dashboard)/subscriptions/[id]/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(dashboard)/subscriptions/[id]/page",pathname:"/subscriptions/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1666:(e,t,s)=>{Promise.resolve().then(s.bind(s,3841))},3841:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(326),r=s(7577),n=s(5047),i=s(6824),l=s(9052),d=s(2980),c=s(7698),o=s(2948);function m(){let{id:e}=(0,n.useParams)(),t=(0,n.useRouter)(),{showToast:s}=(0,o.p)(),[m,u]=(0,r.useState)(null),[x,h]=(0,r.useState)([]),[p,y]=(0,r.useState)(!0),[b,g]=(0,r.useState)(!1),[j,N]=(0,r.useState)(null),[f,v]=(0,r.useState)({productId:"",quantity:"1",unitPrice:""}),[P,w]=(0,r.useState)(!1),D=async()=>{try{let[t,s]=await Promise.all([i.TV.getOne(e),i.F3.getAll()]);u(t),h(s)}catch(e){s(e.message||"Failed to load subscription","error")}finally{y(!1)}},C=async()=>{if(j){g(!0);try{await i.TV.updateStatus(e,j.status),s(`Subscription status updated to ${j.status}`,"success"),N(null),D()}catch(e){s(e.message||"Failed to update status","error")}finally{g(!1)}}},k=async()=>{g(!0);try{let t=await i._g.createOrder(e),a={key:t.key,amount:t.amount,currency:t.currency,name:"SIDAZ",description:`Payment for ${t.subscriptionNumber}`,order_id:t.orderId,handler:async e=>{try{await i._g.verifyPayment({razorpay_order_id:e.razorpay_order_id,razorpay_payment_id:e.razorpay_payment_id,razorpay_signature:e.razorpay_signature}),s("Payment successful!","success"),D()}catch(e){s(e.message||"Payment verification failed","error")}},prefill:{name:m.customer?.name||"",email:m.customer?.email||""},theme:{color:"#1E40AF"}},r=new window.Razorpay(a);r.on("payment.failed",e=>{s("Payment failed: "+(e.error?.description||"Unknown error"),"error")}),r.open()}catch(e){s(e.message||"Failed to initiate payment","error")}finally{g(!1)}},A=async()=>{if(!f.productId||!f.unitPrice){s("Please fill in all line fields","error");return}w(!0);try{await i.TV.addLine(e,{productId:f.productId,quantity:parseInt(f.quantity),unitPrice:parseFloat(f.unitPrice)}),s("Line added successfully","success"),v({productId:"",quantity:"1",unitPrice:""}),D()}catch(e){s(e.message||"Failed to add line","error")}finally{w(!1)}},L=async t=>{try{await i.TV.deleteLine(e,t),s("Line removed","success"),D()}catch(e){s(e.message||"Failed to remove line","error")}};if(p)return a.jsx(d.Z,{message:"Loading subscription..."});if(!m)return(0,a.jsxs)("div",{className:"text-center py-12",children:[a.jsx("p",{className:"text-gray-500",children:"Subscription not found."}),a.jsx("button",{onClick:()=>t.back(),className:"btn-secondary mt-4",children:"Go Back"})]});let S=(()=>{let e=[];switch(m.status){case"DRAFT":e.push({status:"PAY",label:"Pay Now",className:"btn-primary",handler:k});break;case"CONFIRMED":m.paymentLinkExpiry&&new Date(m.paymentLinkExpiry)>new Date&&e.push({status:"PAY",label:"Complete Payment",className:"btn-primary",handler:k});break;case"ACTIVE":e.push({status:"CLOSED",label:"Close Subscription",className:"btn-danger"})}return e})(),_=m.lines?.reduce((e,t)=>e+Number(t.amount||0),0)||0,E=Number(m.plan?.price||0);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("button",{onClick:()=>t.back(),className:"btn-secondary btn-sm",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),(0,a.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:["Subscription ",m.subscriptionNumber]}),a.jsx(l.Z,{status:m.status})]}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Customer"}),a.jsx("p",{className:"font-medium text-gray-900",children:m.customer?.name||"-"})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Plan"}),a.jsx("p",{className:"font-medium text-gray-900",children:m.plan?.name||"-"}),m.plan?.price&&(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["₹",Number(m.plan.price).toFixed(2)," / ",m.plan.billingPeriod?.toLowerCase()]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Start Date"}),a.jsx("p",{className:"font-medium text-gray-900",children:new Date(m.startDate).toLocaleDateString()})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Expiration Date"}),a.jsx("p",{className:"font-medium text-gray-900",children:m.expirationDate?new Date(m.expirationDate).toLocaleDateString():"-"})]})]}),(m.razorpayOrderId||m.razorpayPaymentId)&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Payment Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.amountDue&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Amount"}),(0,a.jsxs)("p",{className:"font-medium text-gray-900",children:["₹",Number(m.amountDue).toFixed(2)]})]}),m.razorpayPaymentId&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Transaction ID"}),a.jsx("p",{className:"font-medium text-gray-900 font-mono text-sm",children:m.razorpayPaymentId})]}),m.paymentLinkExpiry&&"CONFIRMED"===m.status&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Payment Expires"}),a.jsx("p",{className:"font-medium text-gray-900",children:new Date(m.paymentLinkExpiry).toLocaleString()})]})]})]}),"DRAFT"===m.status&&a.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Amount"}),(0,a.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:["₹",(_>0?_:E).toFixed(2)]})]})}),(0,a.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 flex items-center gap-3",children:[S.map(e=>a.jsx("button",{onClick:()=>{e.handler?e.handler():N({status:e.status,label:e.label})},className:e.className,disabled:b,children:b?"Processing...":e.label},e.status)),0===S.length&&"CLOSED"===m.status&&a.jsx("p",{className:"text-sm text-gray-500",children:"This subscription is closed."})]})]}),(0,a.jsxs)("div",{className:"card p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Subscription Lines"}),a.jsx("div",{className:"table-container",children:(0,a.jsxs)("table",{className:"data-table",children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Product"}),a.jsx("th",{children:"Quantity"}),a.jsx("th",{children:"Unit Price"}),a.jsx("th",{children:"Amount"}),"DRAFT"===m.status&&a.jsx("th",{children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[m.lines?.map((e,t)=>a.jsxs("tr",{children:[a.jsx("td",{className:"font-medium text-gray-900",children:e.product?.name||"-"}),a.jsx("td",{children:e.quantity}),a.jsxs("td",{children:["₹",Number(e.unitPrice).toFixed(2)]}),a.jsxs("td",{className:"font-medium",children:["₹",Number(e.amount||e.unitPrice*e.quantity).toFixed(2)]}),"DRAFT"===m.status&&a.jsx("td",{children:a.jsx("button",{onClick:()=>L(e.id),className:"text-red-500 hover:text-red-700 text-sm",children:"Remove"})})]},e.id||t)),(!m.lines||0===m.lines.length)&&a.jsx("tr",{children:(0,a.jsxs)("td",{colSpan:"DRAFT"===m.status?5:4,className:"text-center py-6 text-gray-500",children:["No lines added yet. ","DRAFT"===m.status&&"Add products below."]})})]})]})}),"DRAFT"===m.status&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Add Line"}),(0,a.jsxs)("div",{className:"flex items-end gap-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("label",{className:"form-label",children:"Product"}),(0,a.jsxs)("select",{value:f.productId,onChange:e=>{let t=x.find(t=>t.id===e.target.value);v({...f,productId:e.target.value,unitPrice:t?String(t.salesPrice):f.unitPrice})},className:"form-select",children:[a.jsx("option",{value:"",children:"Select product..."}),x.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," — ","₹",Number(e.salesPrice).toFixed(2)]},e.id))]})]}),(0,a.jsxs)("div",{className:"w-24",children:[a.jsx("label",{className:"form-label",children:"Qty"}),a.jsx("input",{type:"number",min:"1",value:f.quantity,onChange:e=>v({...f,quantity:e.target.value}),className:"form-input"})]}),(0,a.jsxs)("div",{className:"w-32",children:[a.jsx("label",{className:"form-label",children:"Unit Price"}),a.jsx("input",{type:"number",step:"0.01",value:f.unitPrice,onChange:e=>v({...f,unitPrice:e.target.value}),className:"form-input",placeholder:"0.00"})]}),a.jsx("button",{onClick:A,disabled:P,className:"btn-primary",children:P?"Adding...":"Add"})]})]})]}),m.invoices&&m.invoices.length>0&&(0,a.jsxs)("div",{className:"card p-6",children:[a.jsx("div",{className:"flex items-center justify-between mb-4",children:a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Invoices"})}),a.jsx("div",{className:"table-container",children:(0,a.jsxs)("table",{className:"data-table",children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Invoice #"}),a.jsx("th",{children:"Date"}),a.jsx("th",{children:"Total"}),a.jsx("th",{children:"Paid"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Actions"})]})}),a.jsx("tbody",{children:m.invoices.map(e=>(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"font-mono text-sm font-medium text-gray-900",children:e.invoiceNumber}),a.jsx("td",{children:new Date(e.invoiceDate).toLocaleDateString()}),(0,a.jsxs)("td",{className:"font-medium",children:["₹",Number(e.totalAmount).toLocaleString("en-IN")]}),(0,a.jsxs)("td",{className:"text-emerald-600",children:["₹",Number(e.paidAmount).toLocaleString("en-IN")]}),a.jsx("td",{children:a.jsx(l.Z,{status:e.status})}),a.jsx("td",{children:a.jsx("button",{onClick:()=>t.push(`/invoices/${e.id}`),className:"text-primary hover:underline text-sm",children:"View"})})]},e.id))})]})})]}),a.jsx(c.Z,{isOpen:!!j,onConfirm:C,onCancel:()=>N(null),title:"Change Status",message:`Are you sure you want to change the subscription status to "${j?.status}"?`,confirmLabel:j?.label||"Confirm",variant:j?.status==="CLOSED"?"danger":"warning",loading:b})]})}},7698:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var a=s(326);function r({isOpen:e,onConfirm:t,onCancel:s,title:r,message:n,confirmLabel:i="Confirm",variant:l="danger",loading:d=!1}){return e?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[a.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:s}),(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-sm mx-4 p-6",children:[(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${"danger"===l?"bg-red-100":"bg-yellow-100"}`,children:a.jsx("svg",{className:`w-5 h-5 ${"danger"===l?"text-red-600":"text-yellow-600"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[a.jsx("button",{onClick:s,className:"btn-secondary",children:"Cancel"}),a.jsx("button",{onClick:t,disabled:d,className:"danger"===l?"btn-danger":"btn-primary",children:d?"Processing...":i})]})]})]}):null}},9052:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var a=s(326);let r={DRAFT:"badge-draft",QUOTATION:"badge-quotation",CONFIRMED:"badge-confirmed",ACTIVE:"badge-active",PAID:"badge-paid",CLOSED:"badge-closed",CANCELLED:"badge-cancelled"};function n({status:e}){let t=r[e]||"badge-draft";return a.jsx("span",{className:t,children:e.replace("_"," ")})}},2271:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`E:\frontend\app\(dashboard)\subscriptions\[id]\page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[697,496,315,78],()=>s(4133));module.exports=a})();