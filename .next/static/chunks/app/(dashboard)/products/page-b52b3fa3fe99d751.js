(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[393],{1274:function(e,t,a){Promise.resolve().then(a.bind(a,9383))},9383:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(7437),s=a(2265),l=a(9116),i=a(1880),c=a(5838),n=a(6143),d=a(4360);function o(){var e;let[t,a]=(0,s.useState)([]),[o,u]=(0,s.useState)([]),[x,m]=(0,s.useState)(!0),[h,p]=(0,s.useState)(""),[g,v]=(0,s.useState)(""),[j,b]=(0,s.useState)(""),[N,f]=(0,s.useState)(!1),[y,P]=(0,s.useState)(null),[C,w]=(0,s.useState)(null),[k,S]=(0,s.useState)(!1),[L,A]=(0,s.useState)(!1),[F,V]=(0,s.useState)(null),[I,E]=(0,s.useState)({attribute:"",value:"",extraPrice:"0"}),[D,T]=(0,s.useState)(!1),[Y,M]=(0,s.useState)({attributeId:"",attributeValueId:""}),[R,O]=(0,s.useState)(!1),[W,q]=(0,s.useState)({name:"",description:"",productType:"Service",salesPrice:"",costPrice:"",recurringPrice:"",recurringPeriod:"",category:""}),{showToast:B}=(0,d.p)(),_=(0,l.PR)(),H=(null==_?void 0:_.role)==="ADMIN";(0,s.useEffect)(()=>{Z(),z()},[]);let Z=async()=>{try{let e=await l.F3.getAll();a(e)}catch(e){B(e.message||"Failed to load products","error")}finally{m(!1)}},z=async()=>{try{let e=await l.xf.getAll();u(e)}catch(e){}},K=e=>{P(e),q({name:e.name,description:e.description||"",productType:e.productType,salesPrice:String(e.salesPrice),costPrice:String(e.costPrice),recurringPrice:e.recurringPrice?String(e.recurringPrice):"",recurringPeriod:e.recurringPeriod||"",category:e.category||""}),f(!0)},U=async()=>{if(!W.name||!W.salesPrice||!W.costPrice){B("Name, sales price, and cost price are required","error");return}S(!0);try{let e={...W,salesPrice:parseFloat(W.salesPrice),costPrice:parseFloat(W.costPrice),recurringPrice:W.recurringPrice?parseFloat(W.recurringPrice):null,recurringPeriod:W.recurringPeriod||null,category:W.category||null};y?(await l.F3.update(y.id,e),B("Product updated","success")):(await l.F3.create(e),B("Product created","success")),f(!1),Z()}catch(e){B(e.message||"Failed to save product","error")}finally{S(!1)}},G=async()=>{if(C){A(!0);try{await l.F3.delete(C.id),B("Product deleted","success"),w(null),F===C.id&&V(null),Z()}catch(e){B(e.message||"Failed to delete product","error")}finally{A(!1)}}},J=async e=>{if(!I.attribute||!I.value){B("Attribute and value are required","error");return}T(!0);try{await l.F3.addVariant(e,I),B("Variant added","success"),E({attribute:"",value:"",extraPrice:"0"}),Z()}catch(e){B(e.message||"Failed to add variant","error")}finally{T(!1)}},Q=async(e,t)=>{try{await l.F3.deleteVariant(e,t),B("Variant removed","success"),Z()}catch(e){B(e.message||"Failed to delete variant","error")}},X=async e=>{if(!Y.attributeId||!Y.attributeValueId){B("Select an attribute and value","error");return}O(!0);try{await l.F3.addAttributeLine(e,Y),B("Attribute linked","success"),M({attributeId:"",attributeValueId:""}),Z()}catch(e){B(e.message||"Failed to link attribute","error")}finally{O(!1)}},$=async(e,t)=>{try{await l.F3.deleteAttributeLine(e,t),B("Attribute removed","success"),Z()}catch(e){B(e.message||"Failed to remove attribute","error")}},ee=Y.attributeId&&(null===(e=o.find(e=>e.id===Y.attributeId))||void 0===e?void 0:e.values)||[],et=Array.from(new Set(t.map(e=>e.category).filter(Boolean))),ea=t.filter(e=>{let t=!h||e.name.toLowerCase().includes(h.toLowerCase())||(e.description||"").toLowerCase().includes(h.toLowerCase()),a=!g||e.productType===g,r=!j||e.category===j;return t&&a&&r});if(x)return(0,r.jsx)(n.Z,{message:"Loading products..."});let er=e=>(0,r.jsx)("span",{className:{Service:"badge-active",Physical:"badge-confirmed",Digital:"badge-quotation"}[e]||"badge-draft",children:e}),es={DAILY:"/day",WEEKLY:"/week",MONTHLY:"/month",YEARLY:"/year"};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Products"}),H&&(0,r.jsxs)("button",{onClick:()=>{P(null),q({name:"",description:"",productType:"Service",salesPrice:"",costPrice:"",recurringPrice:"",recurringPeriod:"",category:""}),f(!0)},className:"btn-primary",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Product"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("input",{type:"text",placeholder:"Search products...",value:h,onChange:e=>p(e.target.value),className:"form-input flex-1"}),(0,r.jsxs)("select",{value:g,onChange:e=>v(e.target.value),className:"form-select w-40",children:[(0,r.jsx)("option",{value:"",children:"All Types"}),(0,r.jsx)("option",{value:"Service",children:"Service"}),(0,r.jsx)("option",{value:"Physical",children:"Physical"}),(0,r.jsx)("option",{value:"Digital",children:"Digital"})]}),et.length>0&&(0,r.jsxs)("select",{value:j,onChange:e=>b(e.target.value),className:"form-select w-40",children:[(0,r.jsx)("option",{value:"",children:"All Categories"}),et.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[ea.map(e=>{var t,a,s,l;return(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50",onClick:()=>V(F===e.id?null:e.id),children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,r.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform ".concat(F===e.id?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),er(e.productType),e.category&&(0,r.jsx)("span",{className:"badge bg-gray-100 text-gray-600",children:e.category})]}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-500 truncate mt-0.5",children:e.description})]}),(0,r.jsxs)("div",{className:"flex items-center gap-6 text-sm",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-gray-500",children:"Sales Price"}),(0,r.jsxs)("p",{className:"font-semibold text-gray-900",children:["₹",Number(e.salesPrice).toFixed(2)]})]}),e.recurringPrice&&(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-gray-500",children:"Recurring"}),(0,r.jsxs)("p",{className:"font-semibold text-emerald-600",children:["₹",Number(e.recurringPrice).toFixed(2),(0,r.jsx)("span",{className:"text-xs font-normal text-gray-500",children:es[e.recurringPeriod]||""})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-gray-500",children:"Cost"}),(0,r.jsxs)("p",{className:"font-medium text-gray-700",children:["₹",Number(e.costPrice).toFixed(2)]})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-gray-500",children:"Variants"}),(0,r.jsx)("p",{className:"font-medium",children:(null===(t=e.variants)||void 0===t?void 0:t.length)||0})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-gray-500",children:"Attributes"}),(0,r.jsx)("p",{className:"font-medium",children:(null===(a=e.attributes)||void 0===a?void 0:a.length)||0})]})]})]}),H&&(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-4",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{onClick:()=>K(e),className:"btn-secondary btn-sm",children:"Edit"}),(0,r.jsx)("button",{onClick:()=>w(e),className:"btn-danger btn-sm",children:"Delete"})]})]}),F===e.id&&(0,r.jsxs)("div",{className:"border-t border-gray-200 p-4 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Variants"}),(0,r.jsxs)("div",{className:"space-y-1",children:[null===(s=e.variants)||void 0===s?void 0:s.map(t=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"font-medium text-gray-700",children:t.attribute}),(0,r.jsx)("span",{className:"text-gray-400",children:"→"}),(0,r.jsx)("span",{className:"text-gray-900",children:t.value}),t.extraPrice>0&&(0,r.jsxs)("span",{className:"text-emerald-600 text-xs",children:["+","₹",Number(t.extraPrice).toFixed(2)]})]}),H&&(0,r.jsx)("button",{onClick:()=>Q(e.id,t.id),className:"text-red-500 hover:text-red-700 text-xs",children:"Remove"})]},t.id)),(!e.variants||0===e.variants.length)&&(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"No variants yet."})]}),H&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-100 flex items-end gap-2",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("input",{type:"text",placeholder:"Attribute (e.g. Color)",value:I.attribute,onChange:e=>E({...I,attribute:e.target.value}),className:"form-input text-sm"})}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("input",{type:"text",placeholder:"Value (e.g. Red)",value:I.value,onChange:e=>E({...I,value:e.target.value}),className:"form-input text-sm"})}),(0,r.jsx)("div",{className:"w-28",children:(0,r.jsx)("input",{type:"number",step:"0.01",placeholder:"Extra price",value:I.extraPrice,onChange:e=>E({...I,extraPrice:e.target.value}),className:"form-input text-sm"})}),(0,r.jsx)("button",{onClick:()=>J(e.id),disabled:D,className:"btn-primary btn-sm",children:D?"...":"Add"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Linked Attributes"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[null===(l=e.attributes)||void 0===l?void 0:l.map(t=>{var a,s,l;return(0,r.jsxs)("div",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-50 text-blue-800 rounded-full text-sm",children:[(0,r.jsxs)("span",{className:"font-medium",children:[null===(a=t.attribute)||void 0===a?void 0:a.name,":"]}),(0,r.jsx)("span",{children:null===(s=t.attributeValue)||void 0===s?void 0:s.value}),(null===(l=t.attributeValue)||void 0===l?void 0:l.extraPrice)>0&&(0,r.jsxs)("span",{className:"text-blue-500 text-xs",children:["+","₹",t.attributeValue.extraPrice]}),H&&(0,r.jsx)("button",{onClick:()=>$(e.id,t.id),className:"ml-1 text-blue-400 hover:text-red-500",children:(0,r.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t.id)}),(!e.attributes||0===e.attributes.length)&&(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"No attributes linked."})]}),H&&o.length>0&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-100 flex items-end gap-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{className:"form-label text-xs",children:"Attribute"}),(0,r.jsxs)("select",{value:Y.attributeId,onChange:e=>M({attributeId:e.target.value,attributeValueId:""}),className:"form-select text-sm",children:[(0,r.jsx)("option",{value:"",children:"Select Attribute"}),o.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{className:"form-label text-xs",children:"Value"}),(0,r.jsxs)("select",{value:Y.attributeValueId,onChange:e=>M({...Y,attributeValueId:e.target.value}),className:"form-select text-sm",disabled:!Y.attributeId,children:[(0,r.jsx)("option",{value:"",children:"Select Value"}),ee.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.value," ",e.extraPrice>0?"(+₹".concat(e.extraPrice,")"):""]},e.id))]})]}),(0,r.jsx)("button",{onClick:()=>X(e.id),disabled:R,className:"btn-primary btn-sm",children:R?"...":"Link"})]})]})]})]},e.id)}),0===ea.length&&(0,r.jsx)("div",{className:"card p-8 text-center text-gray-500",children:"No products found."})]}),(0,r.jsx)(i.Z,{isOpen:N,onClose:()=>f(!1),title:y?"Edit Product":"New Product",onSubmit:U,submitLabel:y?"Update":"Create",loading:k,children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("label",{className:"form-label",children:"Product Name *"}),(0,r.jsx)("input",{type:"text",required:!0,value:W.name,onChange:e=>q({...W,name:e.target.value}),className:"form-input",placeholder:"Enter product name"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"form-label",children:"Product Type"}),(0,r.jsxs)("select",{value:W.productType,onChange:e=>q({...W,productType:e.target.value}),className:"form-select",children:[(0,r.jsx)("option",{value:"Service",children:"Service"}),(0,r.jsx)("option",{value:"Physical",children:"Physical"}),(0,r.jsx)("option",{value:"Digital",children:"Digital"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"form-label",children:"Category"}),(0,r.jsx)("input",{type:"text",value:W.category,onChange:e=>q({...W,category:e.target.value}),className:"form-input",placeholder:"e.g. Software, Hardware"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"form-label",children:"Sales Price *"}),(0,r.jsx)("input",{type:"number",required:!0,step:"0.01",value:W.salesPrice,onChange:e=>q({...W,salesPrice:e.target.value}),className:"form-input",placeholder:"0.00"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"form-label",children:"Cost Price *"}),(0,r.jsx)("input",{type:"number",required:!0,step:"0.01",value:W.costPrice,onChange:e=>q({...W,costPrice:e.target.value}),className:"form-input",placeholder:"0.00"})]})]}),(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Recurring Pricing (Optional)"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"form-label",children:"Recurring Price"}),(0,r.jsx)("input",{type:"number",step:"0.01",value:W.recurringPrice,onChange:e=>q({...W,recurringPrice:e.target.value}),className:"form-input",placeholder:"0.00"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"form-label",children:"Billing Period"}),(0,r.jsxs)("select",{value:W.recurringPeriod,onChange:e=>q({...W,recurringPeriod:e.target.value}),className:"form-select",children:[(0,r.jsx)("option",{value:"",children:"None"}),(0,r.jsx)("option",{value:"DAILY",children:"Daily"}),(0,r.jsx)("option",{value:"WEEKLY",children:"Weekly"}),(0,r.jsx)("option",{value:"MONTHLY",children:"Monthly"}),(0,r.jsx)("option",{value:"YEARLY",children:"Yearly"})]})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"form-label",children:"Description"}),(0,r.jsx)("textarea",{value:W.description,onChange:e=>q({...W,description:e.target.value}),className:"form-textarea",rows:3,placeholder:"Product description (optional)"})]})]})}),(0,r.jsx)(c.Z,{isOpen:!!C,onConfirm:G,onCancel:()=>w(null),title:"Delete Product",message:'Are you sure you want to delete "'.concat(null==C?void 0:C.name,'"? This action cannot be undone.'),confirmLabel:"Delete",variant:"danger",loading:L})]})}},5838:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var r=a(7437);function s(e){let{isOpen:t,onConfirm:a,onCancel:s,title:l,message:i,confirmLabel:c="Confirm",variant:n="danger",loading:d=!1}=e;return t?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:s}),(0,r.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-sm mx-4 p-6",children:[(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ".concat("danger"===n?"bg-red-100":"bg-yellow-100"),children:(0,r.jsx)("svg",{className:"w-5 h-5 ".concat("danger"===n?"text-red-600":"text-yellow-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:l}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:i})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,r.jsx)("button",{onClick:s,className:"btn-secondary",children:"Cancel"}),(0,r.jsx)("button",{onClick:a,disabled:d,className:"danger"===n?"btn-danger":"btn-primary",children:d?"Processing...":c})]})]})]}):null}}},function(e){e.O(0,[424,971,117,744],function(){return e(e.s=1274)}),_N_E=e.O()}]);