(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[280],{9462:function(e,t,a){Promise.resolve().then(a.bind(a,1601))},1601:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var n=a(7437),s=a(2265),r=a(9116),l=a(1880),i=a(6143),o=a(4360);function c(){let[e,t]=(0,s.useState)([]),[a,c]=(0,s.useState)([]),[d,m]=(0,s.useState)(!0),[u,h]=(0,s.useState)(!1),[x,p]=(0,s.useState)(!1),[v,j]=(0,s.useState)({invoiceId:"",amount:"",paymentMethod:"CREDIT_CARD",paymentDate:new Date().toISOString().split("T")[0],reference:"",notes:""}),{showToast:f}=(0,o.p)();(0,s.useEffect)(()=>{y()},[]);let y=async()=>{try{let[e,a]=await Promise.all([r.iV.getAll(),r.g6.getAll()]);t(e),c(a)}catch(e){f(e.message||"Failed to load data","error")}finally{m(!1)}},N=async()=>{if(!v.invoiceId||!v.amount){f("Please fill in required fields","error");return}p(!0);try{let e={invoiceId:v.invoiceId,amount:parseFloat(v.amount),paymentMethod:v.paymentMethod};v.paymentDate&&(e.paymentDate=v.paymentDate),v.reference&&(e.reference=v.reference),v.notes&&(e.notes=v.notes),await r.iV.create(e),f("Payment recorded successfully","success"),h(!1),y()}catch(e){f(e.message||"Failed to record payment","error")}finally{p(!1)}},g=e=>(0,n.jsx)("span",{className:{CREDIT_CARD:"badge-confirmed",DEBIT_CARD:"badge-active",BANK_TRANSFER:"badge-quotation",UPI:"badge-paid",CASH:"badge-draft",OTHER:"badge-closed"}[e]||"badge-draft",children:{CREDIT_CARD:"Credit Card",DEBIT_CARD:"Debit Card",BANK_TRANSFER:"Bank Transfer",UPI:"UPI",CASH:"Cash",OTHER:"Other"}[e]||e});return d?(0,n.jsx)(i.Z,{message:"Loading payments..."}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Payments"}),(0,n.jsxs)("button",{onClick:()=>{j({invoiceId:"",amount:"",paymentMethod:"CREDIT_CARD",paymentDate:new Date().toISOString().split("T")[0],reference:"",notes:""}),h(!0)},className:"btn-primary",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Record Payment"]})]}),(0,n.jsx)("div",{className:"table-container",children:(0,n.jsxs)("table",{className:"data-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Date"}),(0,n.jsx)("th",{children:"Invoice #"}),(0,n.jsx)("th",{children:"Customer"}),(0,n.jsx)("th",{children:"Amount"}),(0,n.jsx)("th",{children:"Method"}),(0,n.jsx)("th",{children:"Reference"})]})}),(0,n.jsxs)("tbody",{children:[e.map(e=>{var t,a,s;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:new Date(e.paymentDate||e.createdAt).toLocaleDateString()}),(0,n.jsx)("td",{className:"font-mono text-sm",children:(null===(t=e.invoice)||void 0===t?void 0:t.invoiceNumber)||"-"}),(0,n.jsx)("td",{children:(null===(s=e.invoice)||void 0===s?void 0:null===(a=s.customer)||void 0===a?void 0:a.name)||"-"}),(0,n.jsxs)("td",{className:"font-medium text-emerald-600",children:["₹",Number(e.amount).toLocaleString("en-IN",{minimumFractionDigits:2})]}),(0,n.jsx)("td",{children:g(e.paymentMethod)}),(0,n.jsx)("td",{className:"text-gray-500",children:e.reference||"-"})]},e.id)}),0===e.length&&(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:6,className:"text-center py-8 text-gray-500",children:"No payments recorded yet."})})]})]})}),(0,n.jsx)(l.Z,{isOpen:u,onClose:()=>h(!1),title:"Record Payment",onSubmit:N,submitLabel:"Record",loading:x,children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"form-label",children:"Invoice"}),(0,n.jsxs)("select",{value:v.invoiceId,onChange:e=>j({...v,invoiceId:e.target.value}),className:"form-select",required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select an invoice..."}),a.filter(e=>"CONFIRMED"===e.status).map(e=>{var t;return(0,n.jsxs)("option",{value:e.id,children:[e.invoiceNumber," - ",null===(t=e.customer)||void 0===t?void 0:t.name," (","₹",Number(e.totalAmount-e.paidAmount).toLocaleString("en-IN",{minimumFractionDigits:2})," due)"]},e.id)})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"form-label",children:"Amount"}),(0,n.jsx)("input",{type:"number",step:"0.01",value:v.amount,onChange:e=>j({...v,amount:e.target.value}),className:"form-input",placeholder:"0.00",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"form-label",children:"Payment Method"}),(0,n.jsxs)("select",{value:v.paymentMethod,onChange:e=>j({...v,paymentMethod:e.target.value}),className:"form-select",children:[(0,n.jsx)("option",{value:"CREDIT_CARD",children:"Credit Card"}),(0,n.jsx)("option",{value:"DEBIT_CARD",children:"Debit Card"}),(0,n.jsx)("option",{value:"BANK_TRANSFER",children:"Bank Transfer"}),(0,n.jsx)("option",{value:"UPI",children:"UPI"}),(0,n.jsx)("option",{value:"CASH",children:"Cash"}),(0,n.jsx)("option",{value:"OTHER",children:"Other"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"form-label",children:"Payment Date"}),(0,n.jsx)("input",{type:"date",value:v.paymentDate,onChange:e=>j({...v,paymentDate:e.target.value}),className:"form-input"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"form-label",children:"Reference"}),(0,n.jsx)("input",{type:"text",value:v.reference,onChange:e=>j({...v,reference:e.target.value}),className:"form-input",placeholder:"Transaction reference (optional)"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"form-label",children:"Notes"}),(0,n.jsx)("textarea",{value:v.notes,onChange:e=>j({...v,notes:e.target.value}),className:"form-textarea",rows:2,placeholder:"Additional notes (optional)"})]})]})})]})}}},function(e){e.O(0,[424,971,117,744],function(){return e(e.s=9462)}),_N_E=e.O()}]);