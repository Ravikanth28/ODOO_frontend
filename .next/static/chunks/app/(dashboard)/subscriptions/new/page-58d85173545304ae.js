(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[115],{1904:function(e,t,r){Promise.resolve().then(r.bind(r,5647))},5647:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var s=r(7437),a=r(2265),n=r(9376),o=r(9116),i=r(6143),c=r(4360);function l(){let[e,t]=(0,a.useState)([]),[r,l]=(0,a.useState)([]),[d,u]=(0,a.useState)(!0),[m,p]=(0,a.useState)(!1),[h,g]=(0,a.useState)(null),[b,y]=(0,a.useState)(!1),[f,x]=(0,a.useState)({customerId:"",planId:"",startDate:new Date().toISOString().split("T")[0],expirationDate:"",paymentTerms:""}),S=(0,n.useRouter)(),{showToast:N}=(0,c.p)(),v=(null==h?void 0:h.role)==="PORTAL_USER";(0,a.useEffect)(()=>{let e=(0,o.PR)();g(e),(null==e?void 0:e.role)==="PORTAL_USER"&&x(t=>({...t,customerId:e.id})),O(e)},[]);let O=async e=>{try{let r=[o.Co.getAll()];(null==e?void 0:e.role)!=="PORTAL_USER"&&r.push(o.h3.getAll({role:"PORTAL_USER"}));let s=await Promise.all(r);l(s[0]),s[1]&&t(s[1])}catch(e){N(e.message||"Failed to load data","error")}finally{u(!1)}},P=async e=>{if(e.preventDefault(),!v&&!f.customerId){N("Please select a customer","error");return}if(!f.planId){N("Please select a plan","error");return}p(!0);try{let e={planId:f.planId,startDate:f.startDate};v||(e.customerId=f.customerId),f.expirationDate&&(e.expirationDate=f.expirationDate),f.paymentTerms&&(e.paymentTerms=f.paymentTerms),await o.TV.create(e),N("Subscription created successfully","success"),S.push("/subscriptions")}catch(e){N(e.message||"Failed to create subscription","error")}finally{p(!1)}};return d?(0,s.jsx)(i.Z,{message:"Loading form data..."}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("button",{onClick:()=>S.back(),className:"btn-secondary btn-sm",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"New Subscription"})]}),(0,s.jsx)("div",{className:"card p-6",children:(0,s.jsxs)("form",{onSubmit:P,className:"space-y-5",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[v?(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"Customer"}),(0,s.jsx)("input",{type:"text",value:(null==h?void 0:h.name)||"",className:"form-input bg-gray-50",disabled:!0}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Subscription will be created for your account"})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"Customer"}),(0,s.jsxs)("select",{value:f.customerId,onChange:e=>x({...f,customerId:e.target.value}),className:"form-select",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select a customer..."}),e.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.email,")"]},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"Plan"}),(0,s.jsxs)("select",{value:f.planId,onChange:e=>x({...f,planId:e.target.value}),className:"form-select",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select a plan..."}),r.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," - ","₹",Number(e.price).toFixed(2)," / ",e.billingPeriod.toLowerCase()]},e.id))]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"Start Date"}),(0,s.jsx)("input",{type:"date",value:f.startDate,onChange:e=>x({...f,startDate:e.target.value}),className:"form-input",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"Expiration Date"}),(0,s.jsx)("input",{type:"date",value:f.expirationDate,onChange:e=>x({...f,expirationDate:e.target.value}),className:"form-input"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"Payment Terms"}),(0,s.jsx)("input",{type:"text",value:f.paymentTerms,onChange:e=>x({...f,paymentTerms:e.target.value}),className:"form-input",placeholder:"e.g., Net 30, Due on Receipt"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 pt-4 border-t border-gray-200",children:[(0,s.jsx)("button",{type:"submit",disabled:m,className:"btn-primary",children:m?"Creating...":"Create Subscription"}),(0,s.jsx)("button",{type:"button",onClick:()=>S.back(),className:"btn-secondary",children:"Cancel"}),(0,s.jsxs)("button",{type:"button",onClick:()=>y(!b),className:"btn-secondary ml-auto flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),b?"Hide Plans":"Show Plans"]})]})]})}),b&&(0,s.jsxs)("div",{className:"card p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Available Plans"}),0===r.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No plans available."}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(e=>(0,s.jsxs)("div",{onClick:()=>{x({...f,planId:e.id}),y(!1),N("Selected plan: ".concat(e.name),"success")},className:"border rounded-xl p-4 cursor-pointer transition-all hover:shadow-md ".concat(f.planId===e.id?"border-primary bg-primary/5 ring-1 ring-primary":"border-gray-200 hover:border-primary/30"),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),f.planId===e.id&&(0,s.jsx)("span",{className:"text-xs bg-primary text-white px-2 py-0.5 rounded-full",children:"Selected"})]}),e.description&&(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-3",children:e.description}),(0,s.jsxs)("div",{className:"flex items-baseline gap-1 mb-3",children:[(0,s.jsxs)("span",{className:"text-xl font-bold text-gray-900",children:["₹",Number(e.price).toLocaleString("en-IN")]}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:["/ ",e.billingPeriod.toLowerCase()]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-1.5 text-xs",children:[(0,s.jsx)("span",{className:"px-2 py-0.5 bg-blue-50 text-blue-700 rounded-full",children:e.billingPeriod}),e.renewable&&(0,s.jsx)("span",{className:"px-2 py-0.5 bg-green-50 text-green-700 rounded-full",children:"Renewable"}),e.pausable&&(0,s.jsx)("span",{className:"px-2 py-0.5 bg-amber-50 text-amber-700 rounded-full",children:"Pausable"}),e.closable&&(0,s.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full",children:"Closable"})]})]},e.id))})]})]})}},6143:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var s=r(7437);function a(e){let{message:t="Loading..."}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-3 border-primary/30 border-t-primary rounded-full animate-spin"}),(0,s.jsx)("p",{className:"mt-3 text-sm text-gray-500",children:t})]})}},4360:function(e,t,r){"use strict";r.d(t,{ToastProvider:function(){return c},p:function(){return o}});var s=r(7437),a=r(2265);let n=(0,a.createContext)({showToast:()=>{}}),o=()=>(0,a.useContext)(n),i=0;function c(e){let{children:t}=e,[r,o]=(0,a.useState)([]),c=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",r=++i;o(s=>[...s,{id:r,message:e,type:t}]),setTimeout(()=>{o(e=>e.filter(e=>e.id!==r))},4e3)},[]),l=e=>{o(t=>t.filter(t=>t.id!==e))},d={success:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",error:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z",warning:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z",info:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},u={success:"bg-emerald-50 border-emerald-200 text-emerald-800",error:"bg-red-50 border-red-200 text-red-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",info:"bg-blue-50 border-blue-200 text-blue-800"},m={success:"text-emerald-500",error:"text-red-500",warning:"text-yellow-500",info:"text-blue-500"};return(0,s.jsxs)(n.Provider,{value:{showToast:c},children:[t,(0,s.jsx)("div",{className:"fixed top-4 right-4 z-[100] flex flex-col gap-2 max-w-sm",children:r.map(e=>(0,s.jsxs)("div",{className:"".concat(u[e.type]," border rounded-lg p-3 shadow-lg flex items-start gap-3 animate-[slideIn_0.3s_ease-out]"),children:[(0,s.jsx)("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5 ".concat(m[e.type]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:d[e.type]})}),(0,s.jsx)("p",{className:"text-sm flex-1",children:e.message}),(0,s.jsx)("button",{onClick:()=>l(e.id),className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))})]})}},9116:function(e,t,r){"use strict";r.d(t,{Co:function(){return u},F3:function(){return d},JG:function(){return P},PR:function(){return o},QB:function(){return g},QZ:function(){return N},TL:function(){return b},TV:function(){return m},_g:function(){return S},av:function(){return i},ax:function(){return x},g6:function(){return p},gy:function(){return n},h3:function(){return f},iV:function(){return h},kv:function(){return l},o4:function(){return a},rW:function(){return y},tQ:function(){return O},xf:function(){return v}});let s=()=>localStorage.getItem("token"),a=e=>{localStorage.setItem("token",e)},n=()=>{localStorage.removeItem("token"),localStorage.removeItem("user")},o=()=>{{let e=localStorage.getItem("user");return e?JSON.parse(e):null}},i=e=>{localStorage.setItem("user",JSON.stringify(e))},c=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=s(),a={"Content-Type":"application/json",...r&&{Authorization:"Bearer ".concat(r)},...t.headers},n=await fetch("".concat("http://localhost:5001/api").concat(e),{...t,headers:a});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Request failed"}))).error||"Request failed");return n.json()},l={signup:e=>c("/auth/signup",{method:"POST",body:JSON.stringify(e)}),login:e=>c("/auth/login",{method:"POST",body:JSON.stringify(e)}),requestPasswordReset:e=>c("/auth/reset-password-request",{method:"POST",body:JSON.stringify({email:e})}),resetPassword:(e,t)=>c("/auth/reset-password",{method:"POST",body:JSON.stringify({token:e,newPassword:t})}),getCurrentUser:()=>c("/auth/me")},d={getAll:()=>c("/products"),getOne:e=>c("/products/".concat(e)),create:e=>c("/products",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>c("/products/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>c("/products/".concat(e),{method:"DELETE"}),addVariant:(e,t)=>c("/products/".concat(e,"/variants"),{method:"POST",body:JSON.stringify(t)}),getVariants:e=>c("/products/".concat(e,"/variants")),updateVariant:(e,t,r)=>c("/products/".concat(e,"/variants/").concat(t),{method:"PUT",body:JSON.stringify(r)}),deleteVariant:(e,t)=>c("/products/".concat(e,"/variants/").concat(t),{method:"DELETE"}),getAttributeLines:e=>c("/products/".concat(e,"/attributes")),addAttributeLine:(e,t)=>c("/products/".concat(e,"/attributes"),{method:"POST",body:JSON.stringify(t)}),deleteAttributeLine:(e,t)=>c("/products/".concat(e,"/attributes/").concat(t),{method:"DELETE"})},u={getAll:()=>c("/plans"),getOne:e=>c("/plans/".concat(e)),create:e=>c("/plans",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>c("/plans/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>c("/plans/".concat(e),{method:"DELETE"})},m={getAll:()=>c("/subscriptions"),getOne:e=>c("/subscriptions/".concat(e)),create:e=>c("/subscriptions",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>c("/subscriptions/".concat(e),{method:"PUT",body:JSON.stringify(t)}),updateStatus:(e,t)=>c("/subscriptions/".concat(e,"/status"),{method:"PUT",body:JSON.stringify({status:t})}),addLine:(e,t)=>c("/subscriptions/".concat(e,"/lines"),{method:"POST",body:JSON.stringify(t)}),delete:e=>c("/subscriptions/".concat(e),{method:"DELETE"}),deleteLine:(e,t)=>c("/subscriptions/".concat(e,"/lines/").concat(t),{method:"DELETE"}),renew:e=>c("/subscriptions/".concat(e,"/renew"),{method:"POST"}),upsell:(e,t)=>c("/subscriptions/".concat(e,"/upsell"),{method:"POST",body:JSON.stringify({additionalLines:t})}),getHistory:e=>c("/subscriptions/".concat(e,"/history"))},p={getAll:e=>{let t=e?"?"+new URLSearchParams(Object.entries(e).filter(e=>{let[,t]=e;return t})).toString():"";return c("/invoices".concat(t))},getOne:e=>c("/invoices/".concat(e)),generate:(e,t)=>c("/invoices/generate/".concat(e),{method:"POST",body:t?JSON.stringify(t):void 0}),update:(e,t)=>c("/invoices/".concat(e),{method:"PUT",body:JSON.stringify(t)}),confirm:e=>c("/invoices/".concat(e,"/confirm"),{method:"PUT"}),cancel:e=>c("/invoices/".concat(e,"/cancel"),{method:"PUT"}),addLine:(e,t)=>c("/invoices/".concat(e,"/lines"),{method:"POST",body:JSON.stringify(t)}),deleteLine:(e,t)=>c("/invoices/".concat(e,"/lines/").concat(t),{method:"DELETE"})},h={getAll:()=>c("/payments"),getOne:e=>c("/payments/".concat(e)),create:e=>c("/payments",{method:"POST",body:JSON.stringify(e)})},g={getAll:()=>c("/taxes"),getOne:e=>c("/taxes/".concat(e)),create:e=>c("/taxes",{method:"POST",body:JSON.stringify(e)}),suggest:e=>c("/taxes/suggest",{method:"POST",body:JSON.stringify(e)}),calculate:e=>c("/taxes/calculate",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>c("/taxes/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>c("/taxes/".concat(e),{method:"DELETE"})},b={getAll:()=>c("/discounts"),getOne:e=>c("/discounts/".concat(e)),create:e=>c("/discounts",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>c("/discounts/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>c("/discounts/".concat(e),{method:"DELETE"})},y={getAll:()=>c("/quotations"),getOne:e=>c("/quotations/".concat(e)),create:e=>c("/quotations",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>c("/quotations/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>c("/quotations/".concat(e),{method:"DELETE"}),addLine:(e,t)=>c("/quotations/".concat(e,"/lines"),{method:"POST",body:JSON.stringify(t)}),updateLine:(e,t,r)=>c("/quotations/".concat(e,"/lines/").concat(t),{method:"PUT",body:JSON.stringify(r)}),deleteLine:(e,t)=>c("/quotations/".concat(e,"/lines/").concat(t),{method:"DELETE"}),createSubscription:(e,t)=>c("/quotations/".concat(e,"/create-subscription"),{method:"POST",body:JSON.stringify(t)})},f={getAll:e=>{let t=e?"?"+new URLSearchParams(Object.entries(e).filter(e=>{let[,t]=e;return t})).toString():"";return c("/users".concat(t))},getOne:e=>c("/users/".concat(e)),createInternal:e=>c("/users/internal",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>c("/users/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>c("/users/".concat(e),{method:"DELETE"}),changeRole:(e,t)=>c("/users/".concat(e,"/role"),{method:"PUT",body:JSON.stringify({role:t})})},x={getDashboard:()=>c("/reports/dashboard"),getSubscriptions:()=>c("/reports/subscriptions"),getRevenue:()=>c("/reports/revenue"),getPayments:()=>c("/reports/payments"),getOverdueInvoices:()=>c("/reports/overdue-invoices")},S={createOrder:e=>c("/razorpay/create-order",{method:"POST",body:JSON.stringify({subscriptionId:e})}),verifyPayment:e=>c("/razorpay/verify-payment",{method:"POST",body:JSON.stringify(e)})},N={getAll:e=>{let t=e?"?"+new URLSearchParams(Object.entries(e).filter(e=>{let[,t]=e;return void 0!==t})).toString():"";return c("/contacts".concat(t))},getOne:e=>c("/contacts/".concat(e)),create:e=>c("/contacts",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>c("/contacts/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>c("/contacts/".concat(e),{method:"DELETE"}),getChildren:e=>c("/contacts/".concat(e,"/children"))},v={getAll:()=>c("/attributes"),getOne:e=>c("/attributes/".concat(e)),create:e=>c("/attributes",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>c("/attributes/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>c("/attributes/".concat(e),{method:"DELETE"}),addValue:(e,t)=>c("/attributes/".concat(e,"/values"),{method:"POST",body:JSON.stringify(t)}),updateValue:(e,t,r)=>c("/attributes/".concat(e,"/values/").concat(t),{method:"PUT",body:JSON.stringify(r)}),deleteValue:(e,t)=>c("/attributes/".concat(e,"/values/").concat(t),{method:"DELETE"})},O={generateInvoice:e=>c("/pdf/invoice/".concat(e),{method:"POST"}),generateQuotation:e=>c("/pdf/quotation/".concat(e),{method:"POST"})},P={getDashboard:()=>c("/portal/dashboard"),getCatalog:e=>{let t=e?"?"+new URLSearchParams(Object.entries(e).filter(e=>{let[,t]=e;return t})).toString():"";return c("/portal/catalog".concat(t))},getSubscriptions:()=>c("/portal/subscriptions"),getSubscription:e=>c("/portal/subscriptions/".concat(e)),getInvoices:()=>c("/portal/invoices"),getInvoice:e=>c("/portal/invoices/".concat(e)),getPayments:()=>c("/portal/payments"),getProfile:()=>c("/portal/profile"),updateProfile:e=>c("/portal/profile",{method:"PUT",body:JSON.stringify(e)}),subscribe:e=>c("/portal/subscribe",{method:"POST",body:JSON.stringify({planId:e})})}},9376:function(e,t,r){"use strict";var s=r(5475);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=1904)}),_N_E=e.O()}]);