(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[710],{9341:function(e,t,s){Promise.resolve().then(s.bind(s,4783))},4783:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var a=s(7437),n=s(2265),i=s(9116),l=s(1880),r=s(5838),d=s(6143),c=s(4360);function o(){let[e,t]=(0,n.useState)([]),[s,o]=(0,n.useState)([]),[m,u]=(0,n.useState)([]),[x,h]=(0,n.useState)([]),[p,g]=(0,n.useState)(!0),[j,y]=(0,n.useState)(!1),[v,N]=(0,n.useState)(null),[b,f]=(0,n.useState)(null),[C,w]=(0,n.useState)(!1),[P,S]=(0,n.useState)(!1),[k,D]=(0,n.useState)(null),[I,L]=(0,n.useState)({productId:"",quantity:"1",unitPrice:"",discount:"0"}),[A,F]=(0,n.useState)(!1),[T,q]=(0,n.useState)(!1),[E,W]=(0,n.useState)({templateId:"",customerId:"",startDate:""}),[Y,O]=(0,n.useState)(!1),[M,R]=(0,n.useState)({name:"",description:"",validityDays:"30",planId:"",recurringPeriod:"",notes:"",termsAndConditions:""}),{showToast:_}=(0,c.p)(),Q=(0,i.PR)(),U=(null==Q?void 0:Q.role)==="ADMIN";(0,n.useEffect)(()=>{Z()},[]);let Z=async()=>{try{let[e,s,a,n]=await Promise.all([i.rW.getAll(),i.Co.getAll(),i.F3.getAll(),i.h3.getAll({role:"PORTAL_USER"}).catch(()=>[])]);t(e),o(s),u(a),h(n)}catch(e){_(e.message||"Failed to load data","error")}finally{g(!1)}},B=e=>{N(e),R({name:e.name,description:e.description||"",validityDays:String(e.validityDays),planId:e.planId,recurringPeriod:e.recurringPeriod||"",notes:e.notes||"",termsAndConditions:e.termsAndConditions||""}),y(!0)},H=async()=>{if(!M.name||!M.planId){_("Name and plan are required","error");return}w(!0);try{let e={...M,validityDays:parseInt(M.validityDays)||30,recurringPeriod:M.recurringPeriod||null,notes:M.notes||null,termsAndConditions:M.termsAndConditions||null};v?(await i.rW.update(v.id,e),_("Template updated","success")):(await i.rW.create(e),_("Template created","success")),y(!1),Z()}catch(e){_(e.message||"Failed to save template","error")}finally{w(!1)}},z=async()=>{if(b){S(!0);try{await i.rW.delete(b.id),_("Template deleted","success"),f(null),k===b.id&&D(null),Z()}catch(e){_(e.message||"Failed to delete","error")}finally{S(!1)}}},K=async e=>{if(!I.productId){_("Select a product","error");return}F(!0);try{await i.rW.addLine(e,{productId:I.productId,quantity:parseInt(I.quantity)||1,unitPrice:parseFloat(I.unitPrice)||0,discount:parseFloat(I.discount)||0}),_("Line added","success"),L({productId:"",quantity:"1",unitPrice:"",discount:"0"}),Z()}catch(e){_(e.message||"Failed to add line","error")}finally{F(!1)}},V=async(e,t)=>{try{await i.rW.deleteLine(e,t),_("Line removed","success"),Z()}catch(e){_(e.message||"Failed to remove line","error")}},G=e=>{W({templateId:e,customerId:"",startDate:new Date().toISOString().split("T")[0]}),q(!0)},J=async()=>{if(!E.customerId){_("Select a customer","error");return}O(!0);try{let e=await i.rW.createSubscription(E.templateId,{customerId:E.customerId,startDate:E.startDate});_("Subscription ".concat(e.subscriptionNumber," created!"),"success"),q(!1)}catch(e){_(e.message||"Failed to create subscription","error")}finally{O(!1)}},X=e=>{let t=m.find(t=>t.id===e);L({...I,productId:e,unitPrice:t?String(t.salesPrice):""})},$=async e=>{try{let t=await i.tQ.generateQuotation(e);window.open(t.pdfUrl,"_blank"),_("PDF generated","success")}catch(e){_(e.message||"Failed to generate PDF","error")}},ee={DAILY:"Daily",WEEKLY:"Weekly",MONTHLY:"Monthly",YEARLY:"Yearly"};return p?(0,a.jsx)(d.Z,{message:"Loading quotation templates..."}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Quotation Templates"}),U&&(0,a.jsxs)("button",{onClick:()=>{N(null),R({name:"",description:"",validityDays:"30",planId:"",recurringPeriod:"",notes:"",termsAndConditions:""}),y(!0)},className:"btn-primary",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Template"]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[e.map(e=>{var t,s,n,i;let l=(null===(t=e.lines)||void 0===t?void 0:t.reduce((e,t)=>e+(t.quantity*t.unitPrice-(t.discount||0)),0))||0;return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50",onClick:()=>D(k===e.id?null:e.id),children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform ".concat(k===e.id?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsx)("span",{className:"badge bg-blue-100 text-blue-700",children:null===(s=e.plan)||void 0===s?void 0:s.name}),e.recurringPeriod&&(0,a.jsx)("span",{className:"badge bg-emerald-100 text-emerald-700",children:ee[e.recurringPeriod]})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-500 truncate mt-0.5",children:e.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6 text-sm",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-gray-500",children:"Validity"}),(0,a.jsxs)("p",{className:"font-medium",children:[e.validityDays," days"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-gray-500",children:"Lines"}),(0,a.jsx)("p",{className:"font-medium",children:(null===(n=e.lines)||void 0===n?void 0:n.length)||0})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-gray-500",children:"Total"}),(0,a.jsxs)("p",{className:"font-semibold text-gray-900",children:["₹",l.toFixed(2)]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-4",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{onClick:()=>$(e.id),className:"btn-secondary btn-sm",children:"PDF"}),(0,a.jsx)("button",{onClick:()=>G(e.id),className:"btn-primary btn-sm",children:"Create Sub"}),U&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>B(e),className:"btn-secondary btn-sm",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>f(e),className:"btn-danger btn-sm",children:"Delete"})]})]})]}),k===e.id&&(0,a.jsxs)("div",{className:"border-t border-gray-200 p-4 space-y-4",children:[(e.notes||e.termsAndConditions)&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[e.notes&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Notes"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:e.notes})]}),e.termsAndConditions&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Terms & Conditions"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:e.termsAndConditions})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Line Items"}),(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-gray-600",children:"Product"}),(0,a.jsx)("th",{className:"text-right px-3 py-2 font-medium text-gray-600",children:"Qty"}),(0,a.jsx)("th",{className:"text-right px-3 py-2 font-medium text-gray-600",children:"Unit Price"}),(0,a.jsx)("th",{className:"text-right px-3 py-2 font-medium text-gray-600",children:"Discount"}),(0,a.jsx)("th",{className:"text-right px-3 py-2 font-medium text-gray-600",children:"Subtotal"}),U&&(0,a.jsx)("th",{className:"px-3 py-2 w-16"})]})}),(0,a.jsxs)("tbody",{children:[null===(i=e.lines)||void 0===i?void 0:i.map(t=>{var s;return(0,a.jsxs)("tr",{className:"border-t border-gray-100",children:[(0,a.jsx)("td",{className:"px-3 py-2 font-medium text-gray-900",children:null===(s=t.product)||void 0===s?void 0:s.name}),(0,a.jsx)("td",{className:"px-3 py-2 text-right",children:t.quantity}),(0,a.jsxs)("td",{className:"px-3 py-2 text-right",children:["₹",Number(t.unitPrice).toFixed(2)]}),(0,a.jsx)("td",{className:"px-3 py-2 text-right",children:t.discount>0?"₹".concat(Number(t.discount).toFixed(2)):"-"}),(0,a.jsxs)("td",{className:"px-3 py-2 text-right font-medium",children:["₹",(t.quantity*t.unitPrice-(t.discount||0)).toFixed(2)]}),U&&(0,a.jsx)("td",{className:"px-3 py-2 text-right",children:(0,a.jsx)("button",{onClick:()=>V(e.id,t.id),className:"text-red-500 hover:text-red-700 text-xs",children:"Remove"})})]},t.id)}),(!e.lines||0===e.lines.length)&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:U?6:5,className:"px-3 py-4 text-center text-gray-500",children:"No line items."})})]})]})}),U&&(0,a.jsxs)("div",{className:"mt-3 flex items-end gap-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("select",{value:I.productId,onChange:e=>X(e.target.value),className:"form-select text-sm",children:[(0,a.jsx)("option",{value:"",children:"Select Product"}),m.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ","₹",Number(e.salesPrice).toFixed(2)]},e.id))]})}),(0,a.jsx)("div",{className:"w-20",children:(0,a.jsx)("input",{type:"number",min:"1",placeholder:"Qty",value:I.quantity,onChange:e=>L({...I,quantity:e.target.value}),className:"form-input text-sm"})}),(0,a.jsx)("div",{className:"w-28",children:(0,a.jsx)("input",{type:"number",step:"0.01",placeholder:"Price",value:I.unitPrice,onChange:e=>L({...I,unitPrice:e.target.value}),className:"form-input text-sm"})}),(0,a.jsx)("div",{className:"w-24",children:(0,a.jsx)("input",{type:"number",step:"0.01",placeholder:"Discount",value:I.discount,onChange:e=>L({...I,discount:e.target.value}),className:"form-input text-sm"})}),(0,a.jsx)("button",{onClick:()=>K(e.id),disabled:A,className:"btn-primary btn-sm",children:A?"...":"Add"})]})]})]})]},e.id)}),0===e.length&&(0,a.jsx)("div",{className:"card p-8 text-center text-gray-500",children:"No quotation templates found. Create one to get started."})]}),(0,a.jsx)(l.Z,{isOpen:j,onClose:()=>y(!1),title:v?"Edit Template":"New Quotation Template",onSubmit:H,submitLabel:v?"Update":"Create",loading:C,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"form-label",children:"Template Name *"}),(0,a.jsx)("input",{type:"text",required:!0,value:M.name,onChange:e=>R({...M,name:e.target.value}),className:"form-input",placeholder:"e.g., Enterprise Annual Plan"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Recurring Plan *"}),(0,a.jsxs)("select",{value:M.planId,onChange:e=>R({...M,planId:e.target.value}),className:"form-select",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select a plan..."}),s.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ","₹",Number(e.price).toFixed(2)," / ",e.billingPeriod.toLowerCase()]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Validity Days"}),(0,a.jsx)("input",{type:"number",min:"1",value:M.validityDays,onChange:e=>R({...M,validityDays:e.target.value}),className:"form-input"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"form-label",children:"Recurring Period Override"}),(0,a.jsxs)("select",{value:M.recurringPeriod,onChange:e=>R({...M,recurringPeriod:e.target.value}),className:"form-select",children:[(0,a.jsx)("option",{value:"",children:"Use plan default"}),(0,a.jsx)("option",{value:"DAILY",children:"Daily"}),(0,a.jsx)("option",{value:"WEEKLY",children:"Weekly"}),(0,a.jsx)("option",{value:"MONTHLY",children:"Monthly"}),(0,a.jsx)("option",{value:"YEARLY",children:"Yearly"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Description"}),(0,a.jsx)("textarea",{value:M.description,onChange:e=>R({...M,description:e.target.value}),className:"form-textarea",rows:2,placeholder:"Template description (optional)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Notes"}),(0,a.jsx)("textarea",{value:M.notes,onChange:e=>R({...M,notes:e.target.value}),className:"form-textarea",rows:2,placeholder:"Internal notes (optional)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Terms & Conditions"}),(0,a.jsx)("textarea",{value:M.termsAndConditions,onChange:e=>R({...M,termsAndConditions:e.target.value}),className:"form-textarea",rows:3,placeholder:"Terms and conditions for quotation (optional)"})]})]})}),(0,a.jsx)(l.Z,{isOpen:T,onClose:()=>q(!1),title:"Create Subscription from Template",onSubmit:J,submitLabel:"Create Subscription",loading:Y,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Customer *"}),(0,a.jsxs)("select",{value:E.customerId,onChange:e=>W({...E,customerId:e.target.value}),className:"form-select",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select customer..."}),x.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.email,")"]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Start Date"}),(0,a.jsx)("input",{type:"date",value:E.startDate,onChange:e=>W({...E,startDate:e.target.value}),className:"form-input"})]})]})}),(0,a.jsx)(r.Z,{isOpen:!!b,onConfirm:z,onCancel:()=>f(null),title:"Delete Template",message:'Delete "'.concat(null==b?void 0:b.name,'"? This action cannot be undone.'),confirmLabel:"Delete",variant:"danger",loading:P})]})}},5838:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var a=s(7437);function n(e){let{isOpen:t,onConfirm:s,onCancel:n,title:i,message:l,confirmLabel:r="Confirm",variant:d="danger",loading:c=!1}=e;return t?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:n}),(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-sm mx-4 p-6",children:[(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ".concat("danger"===d?"bg-red-100":"bg-yellow-100"),children:(0,a.jsx)("svg",{className:"w-5 h-5 ".concat("danger"===d?"text-red-600":"text-yellow-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:i}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:l})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,a.jsx)("button",{onClick:n,className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{onClick:s,disabled:c,className:"danger"===d?"btn-danger":"btn-primary",children:c?"Processing...":r})]})]})]}):null}}},function(e){e.O(0,[424,971,117,744],function(){return e(e.s=9341)}),_N_E=e.O()}]);